<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>متجر كوينز</title>
  <style>
    body {font-family: Arial, sans-serif; margin:0; padding:0; background:#f9f9f9; direction:rtl;}
    header {background:#007bff; color:#fff; padding:15px; text-align:center; font-size:20px;}
    .products {display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:15px; padding:20px;}
    .card {background:#fff; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); padding:15px; text-align:center;}
    .card img {max-width:100%; border-radius:10px;}
    .price {margin:10px 0; font-weight:bold; color:#333;}
    .btn {background:#007bff; color:#fff; border:none; padding:10px 15px; border-radius:8px; cursor:pointer;}
    .btn:hover {background:#0056b3;}
    /* نافذة الطلب */
    .popup {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:1000;}
    .popup-content {background:#fff; padding:20px; border-radius:15px; width:90%; max-width:400px; text-align:center; position:relative;}
    .close {position:absolute; top:10px; left:10px; cursor:pointer; font-size:20px;}
    .qr-img {width:200px; margin:10px auto;}
    input {width:90%; padding:8px; margin:6px 0; border:1px solid #ccc; border-radius:8px;}
    .row {display:flex; justify-content:space-between; gap:5px;}
    .row input {width:48%;}
    /* سلة عائمة (يسار أعلى) */
    .cart-btn {
      position:fixed;
      top:70px; /* أسفل الهيدر */
      left:20px;
      background:#222;
      color:#fff;
      padding:10px 15px;
      border-radius:30px;
      box-shadow:0 4px 10px rgba(0,0,0,0.3);
      cursor:pointer;
      z-index:1100;
    }
    .checkmark {display:none; font-size:48px; color:green; animation:pop 0.5s ease;}
    @keyframes pop {0%{transform:scale(0);}100%{transform:scale(1);}}
    /* تحسين نافذة السلة */
    #ordersListPopup {
      display:none; 
      position:fixed; 
      top:0; left:0; 
      width:100%; height:100%; 
      background:rgba(0,0,0,0.6); 
      align-items:center; 
      justify-content:center; 
      z-index:2000;
    }
    #ordersListPopup .popup-content {
      background:#fff;
      padding:20px;
      border-radius:15px;
      width:90%;
      max-width:600px;
      text-align:right;
      max-height:80vh;
      overflow-y:auto;
      position:relative;
    }
    #ordersListPopup .close {
      position:absolute;
      top:10px;
      left:10px;
      cursor:pointer;
      font-size:22px;
      color:#333;
    }
    .order-card {
      background:#fdfdfd;
      border-radius:12px;
      box-shadow:0 2px 8px rgba(0,0,0,0.1);
      padding:12px;
      margin-bottom:10px;
    }
    .order-card strong {color:#007bff;}
    .order-card p {margin:4px 0; font-size:14px;}
  </style>
</head>
<body>
<header>🛒 متجر الكوينز</header>

<div class="products" id="products"></div>

<!-- نافذة الطلب -->
<div class="popup" id="orderPopup">
  <div class="popup-content">
    <span class="close" onclick="closeOrderPopup()">&times;</span>
    <h3 id="popupTitle"></h3>
    <div id="stepContent"></div>
    <div class="checkmark" id="checkmark">✔️</div>
  </div>
</div>

<!-- نافذة عرض الطلبات -->
<div class="popup" id="ordersListPopup">
  <div class="popup-content">
    <span class="close" onclick="closeOrdersPopup()">&times;</span>
    <h3>🛍️ قائمة الطلبات</h3>
    <div id="ordersList"></div>
  </div>
</div>

<!-- زر السلة -->
<div class="cart-btn" onclick="showOrdersPopup()">🛍️ <span id="cartCount">0</span></div>

<script>
const productsData = [
  {id:1, title:"سوشيال ميديا", price:1.2, img:"https://via.placeholder.com/200"},
  {id:2, title:"شدات ببجي", price:2.5, img:"https://via.placeholder.com/200"},
  {id:3, title:"جواهر فري فاير", price:3.1, img:"https://via.placeholder.com/200"},
  {id:4, title:"بطاقات آيتونز", price:5.0, img:"https://via.placeholder.com/200"},
  {id:5, title:"كرديت كول أوف ديوتي", price:4.7, img:"https://via.placeholder.com/200"},
  {id:6, title:"بطاقات بلايستيشن", price:7.3, img:"https://via.placeholder.com/200"},
  {id:7, title:"بطاقات جوجل بلاي", price:6.2, img:"https://via.placeholder.com/200"},
  {id:8, title:"بطاقات نتفلكس", price:8.9, img:"https://via.placeholder.com/200"},
  {id:9, title:"بطاقات سبوتيفاي", price:9.5, img:"https://via.placeholder.com/200"},
  {id:10, title:"باكجات كوينز فيفا", price:11.0, img:"https://via.placeholder.com/200"},
  {id:11, title:"روبكس روبلوكس", price:3.8, img:"https://via.placeholder.com/200"},
  {id:12, title:"باكجات بيس", price:6.7, img:"https://via.placeholder.com/200"}
];
let currentProduct=null, currentStep=1, customerName="", customerID="", customerWhatsApp="", coinAmount=0, coinPrice=0;
let sentOrders = JSON.parse(localStorage.getItem('sentOrders')||'[]');
const ownerWhatsApp = "+20123456789";
const ownerEmail = "owner@example.com";

function renderProducts(){
  const productsEl=document.getElementById('products');
  productsEl.innerHTML="";
  productsData.forEach(p=>{
    const card=document.createElement('div');
    card.className="card";
    card.innerHTML=`<img src="${p.img}" alt="${p.title}" />
      <h4>${p.title}</h4>
      <div class="price">${p.price.toFixed(2)} USD</div>
      <button class="btn" onclick="startOrder(${p.id})">أضف للسلة</button>`;
    productsEl.appendChild(card);
  });
}

function startOrder(productId){
  currentProduct=productsData.find(p=>p.id===productId);
  currentStep=1; customerName=""; customerID=""; customerWhatsApp="";
  coinAmount=0; coinPrice=0;
  document.getElementById('checkmark').style.display="none";
  document.getElementById('stepContent').style.display="block";
  showStep();
  document.getElementById('orderPopup').style.display="flex";
}
function closeOrderPopup(){document.getElementById('orderPopup').style.display="none";}

function showStep(){
  const title=document.getElementById('popupTitle');
  const content=document.getElementById('stepContent');
  if(currentStep===1){
    title.textContent=`طلب: ${currentProduct.title}`;
    content.innerHTML=`<div class="row">
        <input id="coinAmount" type="number" placeholder="عدد الكوينز" oninput="calcPrice()" />
        <input id="coinPrice" placeholder="السعر (USD)" readonly />
      </div>
      <button class="btn" onclick="nextStep()">التالي</button>`;
  } else if(currentStep===2){
    title.textContent=`معلومات الحساب`;
    content.innerHTML=`<input id="customerName" placeholder="اسمك / حسابك" />
      <input id="customerID" placeholder="ID الحساب" />
      <input id="customerWhatsApp" placeholder="رقم واتساب للتواصل" />
      <button class="btn" onclick="nextStep()">التالي</button>`;
  } else if(currentStep===3){
    title.textContent=`الدفع`;
    content.innerHTML=`<p>امسح الشيفرة للدفع</p>
      <img class="qr-img" src="https://c.top4top.io/p_3512ytqp71.jpg" alt="شيفرة الدفع" />
      <button class="btn" onclick="paymentDone()">تم الدفع</button>`;
  }
}
function calcPrice(){
  const amount=parseInt(document.getElementById('coinAmount').value)||0;
  coinAmount=amount;
  const base=currentProduct.price;
  coinPrice=((amount/1000)* (base+0.3)).toFixed(2);
  document.getElementById('coinPrice').value=coinPrice+" USD";
}
function nextStep(){
  if(currentStep===1){
    if(!coinAmount || coinAmount<=0){alert("أدخل عدد الكوينز"); return;}
    if(!coinPrice || coinPrice<=0){alert("أدخل عدد صحيح لحساب السعر"); return;}
    currentStep++;
  } else if(currentStep===2){
    const name=document.getElementById('customerName').value.trim();
    const id=document.getElementById('customerID').value.trim();
    const wa=document.getElementById('customerWhatsApp').value.trim();
    if(!name||!id||!wa){alert("املأ كل الحقول"); return;}
    customerName=name; customerID=id; customerWhatsApp=wa;
    currentStep++;
  }
  showStep();
}
function paymentDone(){
  document.getElementById('checkmark').style.display="flex";
  document.getElementById('stepContent').style.display="none";
  setTimeout(()=>{
    sendOrder();
    document.getElementById('stepContent').style.display="block";
    document.getElementById('checkmark').style.display="none";
  },2000);
}
function sendOrder(){
  const formattedText=`🛍️ *طلب جديد* 🛍️
━━━━━━━━━━━━━━
📦 *المنتج:* ${currentProduct.title}
💰 *عدد الكوينز:* ${coinAmount}
💵 *السعر:* ${coinPrice} USD
👤 *الاسم/الحساب:* ${customerName}
🆔 *ID:* ${customerID}
📱 *واتساب العميل:* ${customerWhatsApp}
━━━━━━━━━━━━━━
شكراً لطلبك ❤️`;

  if(/Android|iPhone|iPad/i.test(navigator.userAgent)){
    window.location.href=`https://wa.me/${ownerWhatsApp.replace('+','')}?text=${encodeURIComponent(formattedText)}`;
  } else {
    window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(ownerEmail)}&su=${encodeURIComponent('طلب جديد')}&body=${encodeURIComponent(formattedText)}`,'_blank');
  }
  const order={product:currentProduct.title, coins:coinAmount, price:coinPrice, name:customerName, id:customerID, whatsapp:customerWhatsApp};
  sentOrders.push(order);
  localStorage.setItem('sentOrders',JSON.stringify(sentOrders));
  updateCartCount();
  closeOrderPopup();
}

function updateCartCount(){document.getElementById('cartCount').textContent=sentOrders.length;}
function showOrdersPopup(){
  const ordersPopup=document.getElementById('ordersListPopup');
  const ordersList=document.getElementById('ordersList');
  if(sentOrders.length===0){ordersList.innerHTML='<p>لا توجد طلبات حتى الآن.</p>';}
  else {
    ordersList.innerHTML=sentOrders.map((o,i)=>`
      <div class="order-card">
        <strong>طلب #${i+1}</strong>
        <p>📦 المنتج: ${o.product}</p>
        <p>💰 الكوينز: ${o.coins}</p>
        <p>💵 السعر: ${o.price} USD</p>
        <p>👤 الاسم: ${o.name}</p>
        <p>🆔 ID: ${o.id}</p>
        <p>📱 واتساب: ${o.whatsapp}</p>
      </div>`).join('');
  }
  ordersPopup.style.display='flex';
}
function closeOrdersPopup(){document.getElementById('ordersListPopup').style.display='none';}

window.onload=()=>{renderProducts(); updateCartCount();};
</script>
</body>
</html>
